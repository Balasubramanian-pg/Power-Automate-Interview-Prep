# Power Automate Interview Prep Template

## Topic: 66. Handling Timeouts with Run After

**Last Updated:** 2024-05-24  
**Confidence:** ðŸŸ¢ Solid  
**Category:** Patterns | Architecture

---

## What Is It?

Handling Timeouts with "Run After" is a flow control configuration that allows a specific action or scope to execute only when a preceding action fails to complete within its defined duration limit.

**Why It Matters:**  
In enterprise automation, external dependencies (like human approvals or legacy APIs) often fail to respond. Without explicit timeout handling, a flow may hang indefinitely (up to 30 days) or terminate abruptly, leaving business processes in an inconsistent state without notifying administrators or triggering fallback logic.

---

## Core Concepts

- **Run After Statuses** - Every action in Power Automate has four potential exit states: `Succeeded`, `Failed`, `Skipped`, and `Timed Out`. By default, actions only run if the previous one `Succeeded`.
- **Action Timeout Limit** - The duration an action is allowed to run before the engine terminates it. For most actions, the default is 30 days, but this can be customized using ISO 8601 duration format (e.g., `P1D` for one day).
- **Scope Encapsulation** - A container used to group multiple actions so that a single "Run After" configuration can handle a timeout occurring anywhere within that group.

---

## Implementation

### Basic Setup

**Configure Run After (JSON Representation):**

In the underlying code of a Power Automate flow, the `runAfter` property defines the dependency. To handle a timeout, the `TimedOut` status must be explicitly included.

```json
"Notify_Manager_of_Timeout": {
    "runAfter": {
        "Approval_Action": [
            "TimedOut"
        ]
    },
    "type": "ApiConnection",
    "inputs": { ... }
}
```

> [!TIP]
> To configure this in the UI, click the three dots (...) on an action, select **"Configure run after,"** uncheck "is successful," and check **"has timed out."**

---

### Advanced Configuration

**Custom Timeout Duration:**

You can shorten the timeout of an action (like an HTTP request or Approval) by going to **Settings** > **Timeout**. The value must follow the ISO 8601 duration standard.

```javascript
// Example ISO 8601 Durations:
// PT2H  -> 2 Hours
// P1D   -> 1 Day
// PT10M -> 10 Minutes
// P1MT2H -> 1 Month and 2 Hours
```

> [!WARNING]
> If you set a custom timeout on an action but do not configure the subsequent action's "Run After" to include the `TimedOut` status, the entire flow will fail immediately when that timeout is reached.

---

## Common Patterns

### Pattern 1: The Escalation Path

```
[Action: Long Running Task (e.g., Approval)]
       |
       |-- (Run After: Succeeded) --> [Action: Process Results]
       |
       |-- (Run After: Timed Out) --> [Action: Escalate to Manager]
```

This pattern ensures that if a user ignores an approval for the allotted time, the flow doesn't just stop; it proactively moves the process to a secondary authority.

---

### Pattern 2: Try-Catch-Timeout Scope

```
[Scope: Try Block]
   |-- Action 1
   |-- Action 2
[Scope: Catch/Timeout Block] (Run After: Failed OR Timed Out)
   |-- [Action: Log Error/Timeout to SharePoint]
   |-- [Action: Terminate Flow as Failed]
```

Using a Scope allows you to catch a timeout from *any* action within the "Try" block, providing a centralized error and timeout handling mechanism.

---

## Performance & Limits

> [!IMPORTANT]
> **Timeout Limits:**
> - **Flow Run Limit:** 30 days (Maximum duration for any single flow execution).
> - **HTTP Request Limit:** 120 seconds for synchronous responses (unless using asynchronous patterns).
> - **Approval Limit:** 30 days (Hard limit; cannot be extended).

**Optimization Tips:**
- **Shorten Timeouts:** Don't wait 30 days for an API call; set a custom timeout of `PT1M` (1 minute) to fail fast and retry or alert.
- **Parallel Branches:** Use parallel branches to handle "Succeeded" and "Timed Out" paths separately to keep the flow logic clean.
- **State Management:** If a timeout occurs, always update the source system (e.g., Dataverse or SQL) to reflect that the process timed out, preventing "zombie" records.

**When NOT to use:**
- Do not use "Run After: Timed Out" for logic that should run regardless of success (use "Run After: Succeeded, Failed, Skipped, Timed Out" or a "Finally" scope instead).
- Avoid using it for transient network glitches where a **Retry Policy** is more appropriate.

---

## Interview Questions

### Beginner

**Q:** What are the four "Run After" options available for any action in Power Automate?

<details>
<summary>Answer</summary>

The four options are:
1. **Is successful:** The previous action completed without errors.
2. **Has failed:** The previous action encountered a runtime error or was explicitly failed.
3. **Is skipped:** The previous action was not executed (usually due to a conditional branch).
4. **Has timed out:** The previous action exceeded its defined duration limit.

By default, only "Is successful" is selected.

</details>

---

### Intermediate

**Q:** You have an Approval action that times out after the default 30 days. How would you design the flow to notify the initiator 24 hours *before* the timeout occurs?

<details>
<summary>Approach</summary>

**Solution:**
You cannot change the 30-day hard limit, but you can use a **Parallel Branch**.

1. Create a Parallel Branch.
2. **Branch A:** Contains the Approval action.
3. **Branch B:** Contains a "Delay" action set to 29 days, followed by a "Send Email" action.
4. Use a "Terminate" action or a "Scope" to ensure that if Branch A completes, Branch B is cancelled (or vice versa).

> [!TIP]
> A more robust way is to set a custom timeout on the Approval action to 29 days and use "Run After: Timed Out" to trigger the notification.

**Follow-up they'll ask:** "What happens to the flow if the user approves on day 31?"  
**Answer:** The flow run will have already timed out and cancelled the action; the approval link will no longer work.

</details>

---

### Advanced

**Q:** How do you implement a global error and timeout handling strategy for a complex flow with 20+ actions?

<details>
<summary>Solution</summary>

**Architecture:**

The best approach is the **Try-Catch-Finally** pattern using Scopes.

```
[Scope: Main_Logic] (The "Try" block)
    |-- All business logic actions
[Scope: Error_Handler] (The "Catch" block)
    |-- Run After: Main_Logic "Has Failed" OR "Has Timed Out"
    |-- Logic: Log error details, notify Admin, clean up resources.
[Scope: Cleanup] (The "Finally" block)
    |-- Run After: Error_Handler "Is Successful" OR "Is Skipped"
    |-- Logic: Close connections, update status to 'Complete'.
```

**Key considerations:**

```javascript
// Use the result() expression to inspect what happened in the Try block
result('Main_Logic') 
// This returns an array of action outputs, allowing you to filter for 'TimedOut' status.
```

**Trade-offs to discuss:**
- **Granularity:** One big Scope is easier to manage but harder to debug which specific action timed out.
- **Complexity:** Nested scopes can become difficult to navigate in the UI.

</details>

---

## Comparison Table

| Status | Trigger Condition | Common Use Case |
|----------|-----------|---------------|
| **Succeeded** | Action finished perfectly | Standard sequential logic. |
| **Failed** | Logic error, 4xx/5xx API response | Error logging, retries. |
| **Timed Out** | Duration limit exceeded | Escalations, fallback to manual tasks. |
| **Skipped** | Previous condition was false | Logic that must run regardless of branching. |

---

## Real Example

> [!NOTE]
> **Problem:** A manufacturing company had an "Invoice Approval" flow. If a manager didn't approve within 48 hours, the finance department lost early-payment discounts.  
> **Solution:** Set the Approval action timeout to `PT48H`. Configured a "Run After: Timed Out" action to automatically re-route the invoice to a secondary "Group Approval" queue.  
> **Result:** Reduced missed discounts by 95% and ensured no invoice sat idle for more than 2 days.

**Implementation:**
```
[Action: Start and wait for an approval]
    Settings -> Timeout: PT48H
[Action: Update Record to 'Escalated']
    Run After: [Approval] has timed out
[Action: Send Email to Finance]
    Run After: [Update Record] is successful
```

---

## Quick Reference

### ISO 8601 Duration Cheat Sheet

```javascript
P[n]Y[n]M[n]DT[n]H[n]M[n]S
// P: Period (Required)
// Y: Years, M: Months, D: Days
// T: Time Separator (Required before H/M/S)
// H: Hours, M: Minutes, S: Seconds

PT15M // 15 Minutes
P1D   // 1 Day
PT2H  // 2 Hours
```

---

## Practice

**Exercise 1:** Create a flow that attempts to "Get File Content" from a slow legacy server. If the action takes longer than 30 seconds, the flow should instead send a "Server Busy" notification to Teams.

<details>
<summary>Hint</summary>

You need to change the timeout setting of the "Get File Content" action to 30 seconds using ISO 8601 format and then add a Teams action with a specific "Run After" configuration.

</details>

<details>
<summary>Solution</summary>

1. Add **Get File Content** action.
2. Go to **Settings** -> **Timeout** -> Enter `PT30S`.
3. Add **Post a message in a chat or channel** (Teams) action.
4. Click `...` on the Teams action -> **Configure Run After**.
5. Uncheck **is successful** and check **has timed out**.
6. (Optional) Add another branch for success to continue normal processing.

**Key points:**
```javascript
// Timeout Value:
PT30S 

// Run After Config:
"runAfter": { "Get_File_Content": ["TimedOut"] }
```

</details>

---

## Troubleshooting Guide

> [!CAUTION]
> **Common Errors:**

| Error | Cause | Fix |
|-------|-------|-----|
| Flow fails immediately on timeout | The next action is only set to "Run After: Succeeded". | Change "Run After" to include "Timed Out". |
| "The timeout '30' is not valid" | Using integers instead of ISO 8601. | Use `PT30S` or `PT30M` instead of just `30`. |
| Action never times out | Default 30-day limit is active. | Manually set a shorter timeout in the action settings. |

---

## Tags
#architecture #error-handling #run-after #timeouts #governance