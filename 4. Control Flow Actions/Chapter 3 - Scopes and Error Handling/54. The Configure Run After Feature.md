# Power Automate Interview Prep Template

## Topic: 54. The Configure Run After Feature

**Last Updated:** 2024-05-24  
**Confidence:** ðŸŸ¢ Solid  
**Category:** Patterns | Architecture

---

## What Is It?

The "Configure Run After" feature is a conditional execution mechanism in Power Automate that allows developers to define which status of a preceding action (Succeeded, Failed, Skipped, or Timed Out) should trigger the execution of the current action.

**Why It Matters:**  
In production-grade automation, errors are inevitable. Without "Configure Run After," a flow terminates immediately upon any action failure. This feature is the foundational building block for implementing Error Handling (Try-Catch-Finally), ensuring data consistency, and sending failure notifications.

---

## Core Concepts

- **Execution States** - There are four possible states for an action: `Succeeded` (default), `Failed` (action encountered an error), `Skipped` (preceding logic bypassed the action), and `Timed Out` (action exceeded its duration limit).
- **Dependency Logic** - By default, every action is set to run only if the previous action "is Succeeded." Changing this creates a logical dependency that can branch the flow's behavior.
- **Scope Integration** - While "Run After" can be set on individual actions, it is most powerful when applied to **Scope** containers to handle groups of actions as a single logical unit.

---

## Implementation

### Basic Setup

**Action Configuration (JSON Representation):**

In the underlying workflow definition, the `runAfter` property defines the relationship.

```json
"Send_Failure_Email": {
    "runAfter": {
        "Update_SQL_Record": [
            "Failed",
            "TimedOut"
        ]
    },
    "type": "ApiConnection",
    "inputs": { ... }
}
```

> [!TIP]
> To access this in the UI, click the three dots (...) on an action and select **Configure run after**. You can select multiple checkboxes to create an "OR" condition (e.g., Run if Failed OR Timed Out).

---

### Advanced Configuration

**The Result() Expression:**

When using "Run After" with Scopes, you often need to inspect *why* a scope failed. The `result()` expression returns an array of JSON objects representing the status of every action inside a scope.

```javascript
// Filter the results of a Scope to find the specific action that failed
filter(result('Try_Scope'), x => equals(x['status'], 'Failed'))
```

> [!WARNING]
> If you set an action to run after a failure, and that action completes successfully, the overall Flow Run status will be marked as **Succeeded** unless you explicitly terminate it with a "Failed" status.

---

## Common Patterns

### Pattern 1: The Try-Catch Pattern

```
[Scope: Try] 
    |--> Action 1
    |--> Action 2
[Scope: Catch] (Run After: Try has Failed or Timed Out)
    |--> Get Error Details
    |--> Send Notification
```

This is the standard approach for error handling. The "Catch" scope only executes if any action inside the "Try" scope fails.

---

### Pattern 2: The Finally / Cleanup Pattern

```
[Action: Create Temp File]
[Scope: Main Processing]
[Action: Delete Temp File] (Run After: Main Processing has Succeeded, Failed, OR Timed Out)
```

This ensures that the "Delete Temp File" action runs regardless of whether the processing succeeded or failed, preventing the accumulation of orphaned temporary data.

---

## Performance & Limits

> [!IMPORTANT]
> **Logic Limits:**
> - **Maximum Dependencies:** An action can depend on multiple preceding actions. If it does, the "Run After" logic applies to the *combined* result of those actions.
> - **Static Nature:** Run After settings cannot be changed dynamically during runtime via expressions; they are part of the flow definition.
> - **License Requirement:** Available on all Power Automate licenses (Standard and Premium).

**Optimization Tips:**
- Use **Scopes** to group actions rather than setting "Run After" on every individual action; this keeps the flow readable.
- Always include `Timed Out` in your error handling logic for long-running operations like Approval steps.
- Use the `Terminate` action at the end of a "Catch" block if you want the Flow Run history to show a "Failed" status for monitoring purposes.

**When NOT to use:**
- Do not use "Run After" for simple true/false branching; use the **Condition** action instead for better readability.
- Avoid complex "Run After" chains in parallel branches, as it can make the flow logic extremely difficult to debug.

---

## Interview Questions

### Beginner

**Q:** What are the four status options available in the "Configure Run After" settings?

<details>
<summary>Answer</summary>

The four status options are:
1. **Is successful:** The default state; the action runs if the previous one finished without error.
2. **Has failed:** The action runs if the previous one encountered any error (except a timeout).
3. **Is skipped:** The action runs if the previous one was bypassed (e.g., due to a condition or a previous failure).
4. **Has timed out:** The action runs if the previous one hit its execution time limit.

</details>

---

### Intermediate

**Q:** You have a flow that sends an error email when a Scope fails. However, the Flow Run history shows "Succeeded" even when the email is sent. Why is this happening and how do you fix it?

<details>
<summary>Approach</summary>

**Solution:**
This happens because the "Catch" block (the email action) finished successfully. Power Automate evaluates the flow's final status based on the *last* action executed. If the last action is successful, the flow is successful.

**Fix:**
Add a **Terminate** action at the end of your error-handling block and set its status to **Failed**.

```json
{
    "type": "Terminate",
    "inputs": {
        "runStatus": "Failed",
        "runErrorCode": "CustomError",
        "runMessage": "The main processing scope failed."
    }
}
```

> [!TIP]
> You can pass the error message from the failed action into the Terminate action's message field for better logging.

**Follow-up they'll ask:** "Can I use 'Run After' to handle errors in a specific parallel branch?"  
**Answer:** Yes, you can converge parallel branches into a single action and set that action to run only if one of the branches fails.

</details>

---

### Advanced

**Q:** How would you design a flow to handle "Transient Errors" (temporary network blips) versus "Fatal Errors" (invalid data) using Run After?

<details>
<summary>Solution</summary>

**Architecture:**

```
[Action: Main Request] (Retry Policy: Default)
    |
    |-- (Run After: Succeeded) --> [Continue Flow]
    |
    |-- (Run After: Failed/TimedOut) --> [Scope: Error Handler]
```

**Key considerations:**

1. **Retry Policy:** First, configure the action's **Retry Policy** (Settings > Retry Policy) to handle transient errors (e.g., 429 or 502 errors).
2. **Run After Logic:** If the retries fail, the "Run After" logic kicks in.
3. **Inspection:** Inside the Error Handler scope, use `outputs('Main_Request')?['statusCode']` to determine if the error is 400 (Fatal) or 500 (Transient).

**Trade-offs to discuss:**
- **Option A (Inline Run After):** Simple to implement but messy for large flows.
- **Option B (Scope-based):** Cleanest architecture; allows for a single "Catch" block for multiple actions.

</details>

---

## Comparison Table

| Feature | Condition Action | Configure Run After |
|----------|-----------|-----------|
| **Primary Use** | Business Logic (If X = Y) | Error Handling / Exception Logic |
| **Trigger** | Data values/Expressions | Action Execution Status |
| **Visuals** | Creates a Yes/No branch | Changes the arrow connection (dotted line) |
| **Complexity** | Better for simple branches | Better for "Try-Catch" blocks |

---

## Real Example

> [!NOTE]
> **Problem:** A daily flow syncing SQL data to SharePoint would fail silently if the SQL server was offline, leaving the team unaware of missing data.  
> **Solution:** Wrapped the SQL actions in a "Try" Scope and added a "Catch" Scope configured to run after the "Try" scope "Has Failed" or "Has Timed Out."  
> **Result:** The team now receives an immediate Teams notification with the specific SQL error message, reducing data downtime from 24 hours to 15 minutes.

**Implementation:**
1. Scope: `Sync_Data`
2. Action: `Get_Rows_SQL`
3. Scope: `Error_Notification` (Run After: `Sync_Data` Failed)
4. Action: `Post_Teams_Message` (using `result('Sync_Data')` to get error details)

---

## Quick Reference

### Run After States

| State | Description |
|-------|-------------|
| `Succeeded` | Action finished with a 2xx code or successful internal logic. |
| `Failed` | Action returned 4xx/5xx or internal connector error. |
| `Skipped` | Action was not reached because a previous "Run After" condition wasn't met. |
| `TimedOut` | Action exceeded the timeout limit (default is often 30 days, but HTTP is shorter). |

---

## Practice

**Exercise 1:** Create a flow that attempts to get a file from OneDrive. If the file doesn't exist (404 error), the flow should create the file instead of failing.

<details>
<summary>Hint</summary>

Use the "Get File Metadata" action. Set the "Create File" action to run only if "Get File Metadata" has **Failed**.

</details>

<details>
<summary>Solution</summary>

1. **Action:** `Get_file_metadata_using_path`
2. **Action:** `Create_file`
   - Click `...` > **Configure run after**
   - Uncheck **is successful**
   - Check **has failed**
3. **Action:** `Next_Steps`
   - Click `...` > **Configure run after**
   - Check **is successful** (of Create file) AND **is skipped** (of Create file - because if Get Metadata worked, Create File is skipped).

</details>

---

## Troubleshooting Guide

> [!CAUTION]
> **Common Errors:**

| Error | Cause | Fix |
|-------|-------|-----|
| Flow shows "Succeeded" but data is missing. | An error occurred, but a "Run After" action handled it without a `Terminate` (Failed) action. | Add a `Terminate` action with status `Failed` at the end of your error path. |
| Downstream actions are "Skipped" unexpectedly. | A previous action failed, and the next action was only set to run if "Succeeded" (the default). | Update the "Configure Run After" of the skipped action to include the "Failed" status. |
| "Run After" settings are greyed out. | You are trying to configure "Run After" for a Trigger. | Triggers do not have "Run After" settings as they are the starting point of the flow. |

---

## Tags
#architecture #error-handling #best-practices #scopes #governance