# Power Automate Interview Prep Template

## Topic: 60. Getting Error Details with result Function

**Last Updated:** 2024-05-22  
**Confidence:** ðŸŸ¢ Solid  
**Category:** Expressions | Patterns

---

## What Is It?

The `result()` function is a Power Automate expression that returns an array containing the execution details (status, inputs, and outputs) of all actions within a specified scoped container, such as a **Scope**, **Apply to each**, or **Until** block.

**Why It Matters:**  
In enterprise-grade automation, simply knowing a flow failed is insufficient. The `result()` function allows developers to implement robust "Try-Catch" logic, enabling the flow to programmatically identify exactly which action failed, extract the specific error message, and log it to a database or send a detailed notification to support teams.

---

## Core Concepts

- **Scoped Container** - The `result()` function requires the name of a container action (usually a "Scope"). It cannot be used on individual actions outside of a container.
- **Action Status** - Each object in the returned array includes a `status` property, which can be `Succeeded`, `Failed`, `Skipped`, or `TimedOut`.
- **JSON Array Output** - The function returns a collection of objects. To find an error, you must filter this array for items where the status is 'Failed'.

---

## Implementation

### Basic Setup

**result() Expression Syntax:**

```javascript
// Syntax: result('Name_of_Scope_Action')
result('Scope_Try_Block')
```

> [!TIP]
> Always rename your Scope actions before referencing them in the `result()` function. If you rename the Scope later, Power Automate usually updates the reference, but manual verification is safer.

---

### Advanced Configuration

To extract only the error message from a failed scope, you typically combine `result()` with a **Filter Array** action and a **Join** or **First** expression.

```javascript
// Expression to get the error message of the first failed action in a scope
first(body('Filter_Array_of_Results'))?['outputs']?['body']?['error']?['message']
```

> [!WARNING]
> The `result()` function only provides details for the top-level actions inside the specified scope. If you have a nested scope inside the target scope, `result()` will show the status of the nested scope itself, not the individual actions inside that nested scope.

---

## Common Patterns

### Pattern 1: The Try-Catch Pattern

```
[Scope: Try]
   |-- Action 1
   |-- Action 2
[Scope: Catch] (Configure Run After: Has Failed, Has Timed Out)
   |-- Filter Array (From: result('Try'), Condition: item()?['status'] equals 'Failed')
   |-- Compose (Extract error details)
   |-- Send Email/Log Error
```

This is the standard way to handle errors gracefully without the entire flow run being marked as "Failed" immediately.

---

### Pattern 2: Centralized Error Logging

```
[Main Logic]
[Scope: Error_Handler] (Run After: Failed)
   |-- Create record in Dataverse/SQL
   |-- Use result('Main_Logic') to populate 'Error Source' and 'Technical Details'
```

This pattern is used in production environments to create a "Flight Recorder" of all automation failures for Power BI reporting.

---

## Performance & Limits

> [!IMPORTANT]
> **Usage Limits:**
> - **Scope Requirement:** `result()` only works on actions that act as containers.
> - **Array Size:** For very large loops (Apply to each), `result()` can return a massive JSON object, potentially hitting memory limits if the loop contains hundreds of actions.
> - **Execution Context:** The function must be called *after* the target scope has executed (usually in a block configured with "Run After").

**Optimization Tips:**
- Use **Filter Array** immediately after calling `result()` to reduce the data size.
- Only select the specific properties you need (e.g., `name` and `outputs`) using a **Select** action.
- Avoid calling `result()` inside a high-frequency loop; call it once in the "Catch" block.

**When NOT to use:**
- Do not use `result()` for simple success/failure checks where a conditional "Run After" on a single action is sufficient.
- Do not use it to pass data between actions for non-error scenarios; use the action's direct output instead.

---

## Interview Questions

### Beginner

**Q:** What does the `result()` function return in Power Automate?

<details>
<summary>Answer</summary>

The `result()` function returns an **array of objects**. Each object represents an action inside a specified Scope or container and contains details such as the action's name, inputs, outputs, start/end times, and its execution status (Succeeded, Failed, etc.).

Example structure:
```json
[
  {
    "name": "Get_User_Profile",
    "status": "Succeeded",
    "outputs": { ... }
  },
  {
    "name": "Update_Record",
    "status": "Failed",
    "outputs": { "body": { "error": { "message": "Resource not found" } } }
  }
]
```

</details>

---

### Intermediate

**Q:** You have a Scope named "Process_Data". How would you extract the error message of the specific action that caused the Scope to fail?

<details>
<summary>Approach</summary>

**Solution:**
1. Create a **Filter Array** action.
2. Set the "From" field to `@result('Process_Data')`.
3. Set the condition to `@equals(item()?['status'], 'Failed')`.
4. Use a **Compose** action with an expression to access the error message from the first item in the filtered array.

```javascript
// Expression for Compose
first(body('Filter_Array'))?['outputs']?['body']?['error']?['message']
```

> [!TIP]
> Use the optional chaining operator `?` in your expressions to prevent the "Catch" block itself from failing if the error object structure is unexpected.

**Follow-up they'll ask:** "What happens if multiple actions fail inside the scope?"  
**Answer:** The `result()` function will contain all of them. The Filter Array will capture all failed actions, and you can either join them into a single string or loop through them to log each one.

</details>

---

### Advanced

**Q:** How does `result()` behave when used on an "Apply to each" loop, and what are the architectural implications?

<details>
<summary>Solution</summary>

**Architecture:**
When `result()` is called on an "Apply to each" action, it returns the status of the **last iteration** or an aggregation of the loop's execution, but it does not easily provide a flat list of every action inside every iteration in a single call.

**Key considerations:**
To get error details *inside* a loop, the `result()` function should be used on a **Scope inside the loop**.

```
Apply to each
  |-- Scope: Try_Iteration
  |-- Scope: Catch_Iteration (Run After: Failed)
        |-- result('Try_Iteration') -> Logs error for specific item
```

**Trade-offs to discuss:**
- **Option A (Result outside loop):** Easier to implement but harder to pinpoint which specific record in a collection of 1000 caused the failure.
- **Option B (Result inside loop):** Provides granular error reporting per record but increases flow complexity and execution count.

</details>

---

## Comparison Table

| Feature | `result('Scope')` | `actions('Action_Name')` |
|----------|-----------|-----------|
| **Target** | Entire Container (Scope/Loop) | Single Specific Action |
| **Output Type** | Array of Objects | Single Object |
| **Use Case** | Catching "any" error in a block | Checking a specific known dependency |
| **Flexibility** | High (Dynamic discovery of failures) | Low (Hardcoded to one action) |

---

## Real Example

> [!NOTE]
> **Problem:** A financial processing flow was failing intermittently. Support spent hours looking through run histories to find which of the 15 steps failed and what the API error was.  
> **Solution:** Implemented a Try-Catch block using `result('Try_Scope')`. A Filter Array identified the failed action and sent the `outputs('ActionName')?['body']` directly to a Microsoft Teams channel.  
> **Result:** Mean Time to Repair (MTTR) dropped from 4 hours to 15 minutes.

**Implementation:**
```text
Scope: Try
  - HTTP Request
  - Parse JSON
  - Update SQL
Scope: Catch (Run After: Failed)
  - Filter Array: result('Try') where status == 'Failed'
  - Post Message to Teams: "Action @{item()?['name']} failed with error @{item()?['outputs']?['body']?['error']}"
```

---

## Quick Reference

### Common Status Values
- `Succeeded`
- `Failed`
- `Skipped` (Occurs if a previous action failed)
- `TimedOut`

### Useful Expressions
```javascript
// Get the name of the failed action
item()?['name']

// Get the status code
item()?['outputs']?['statusCode']

// Get the full error body
item()?['outputs']?['body']
```

---

## Practice

**Exercise 1:** Create a flow that simulates a failure (e.g., a "Get User Profile" with a non-existent ID) inside a Scope. Use the `result()` function to email yourself the name of the action that failed.

<details>
<summary>Hint</summary>

Wrap the failing action in a Scope. Add an action after the Scope, change its "Configure Run After" to include "Has Failed", and use the `result()` function inside a Filter Array.

</details>

<details>
<summary>Solution</summary>

1. **Scope** (Name: `Main_Scope`)
   - **Get User Profile (V2)**: User ID = `nonexistent@domain.com`
2. **Filter Array** (Run After: `Main_Scope` has failed)
   - From: `@result('Main_Scope')`
   - Condition: `@item()?['status']` is equal to `Failed`
3. **Send Email**
   - Body: `The action @{first(body('Filter_Array'))?['name']} failed.`

**Key points:**
```javascript
// The critical expression to get the name:
first(body('Filter_Array'))?['name']
```

</details>

---

## Troubleshooting Guide

> [!CAUTION]
> **Common Errors:**

| Error | Cause | Fix |
|-------|-------|-----|
| `The function 'result' expected a parameter of type string...` | Passing the action object instead of the name string. | Ensure the name is in single quotes: `result('My_Scope')`. |
| `Action 'My_Scope' is not a container.` | Trying to use `result()` on a single action like "Compose". | Wrap the action in a "Scope" or "Apply to each" first. |
| Empty array returned | The `result()` function is called but all actions succeeded. | Check if your "Run After" settings are correctly triggering the Catch block only on failure. |

---

## Tags
#expressions #error-handling #governance #architecture #try-catch

---