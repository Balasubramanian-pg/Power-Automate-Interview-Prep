# Power Automate Interview Prep Template

## Topic: 63. Terminating Flow on Catch

**Last Updated:** 2024-05-22  
**Confidence:** ðŸŸ¢ Solid  
**Category:** Patterns | Architecture

---

## What Is It?

Terminating Flow on Catch is the architectural practice of using the "Terminate" action within an error-handling block (Catch) to explicitly set the final status of a flow run, ensuring the Run History reflects the actual outcome of the process.

**Why It Matters:**  
By default, if an error is "caught" and handled within a scope, Power Automate considers the error resolved and marks the entire flow run as **Succeeded**. This creates a "false positive" in monitoring dashboards. Explicitly terminating the flow as **Failed** inside the Catch block ensures that IT admins and monitoring tools (like Center of Excellence kits) are correctly alerted to the failure.

---

## Core Concepts

- **Try-Catch Pattern** - A structural design where a "Try" Scope contains the main logic and a "Catch" Scope contains error-handling logic, triggered only if the "Try" Scope fails.
- **Configure Run After** - The setting on the Catch block that allows it to execute only when the preceding block has "Failed," "Skipped," or "Timed Out."
- **Terminal State** - The final status of a flow run (Succeeded, Failed, or Cancelled). The Terminate action allows the developer to override the default engine behavior to set this state.

---

## Implementation

### Basic Setup

**Terminate Action (Failed):**

```json
{
    "inputs": {
        "runStatus": "Failed",
        "runError": {
            "code": "ProcessError",
            "message": "The integration failed during the data transformation step."
        }
    }
}
```

> [!TIP]
> Always place the Terminate action as the *last* step in your Catch scope. This allows you to perform cleanup tasks (like deleting temporary files or sending notifications) before the flow stops.

---

### Advanced Configuration

To provide a dynamic error message in the Terminate action, use the `result()` expression to extract the error details from the failed Scope.

```javascript
// Extracting the error message from the 'Try_Scope'
first(filter(result('Try_Scope'), item()['status'], 'equals', 'Failed'))?['error']?['message']
```

> [!WARNING]
> If you use a Terminate action with a status of "Failed" inside a Catch block, any actions placed *after* the Catch block (outside the scope) will never execute.

---

## Common Patterns

### Pattern 1: Explicit Failure (Standard Catch)

```
[Try Scope] 
    |-- Action 1
    |-- Action 2
[Catch Scope] (Run After: Has Failed)
    |-- Send Email Alert
    |-- Terminate (Status: Failed)
```

This is the most common pattern. It ensures that the flow stops immediately after an error is logged and the run is marked as a failure for administrative review.

---

### Pattern 2: Graceful Degradation (Handled Catch)

```
[Try Scope]
    |-- Get Data from Premium API
[Catch Scope] (Run After: Has Failed)
    |-- Get Data from Legacy Backup System
    |-- Terminate (Status: Succeeded) // Optional/Implicit
```

In this pattern, the Catch block "fixes" the problem. You might choose *not* to use a Terminate action, or use `Terminate (Succeeded)`, because the business process actually completed successfully via an alternative path.

---

## Performance & Limits

> [!IMPORTANT]
> **Execution Limits:**
> - The Terminate action is a "Control" connector action and counts toward your daily Request Limits.
> - Once a Terminate action is hit, all asynchronous operations (like parallel branches) are immediately cancelled.
> - **License Requirement:** Available on all Power Automate plans (Standard and Premium).

**Optimization Tips:**
- Use the `code` property in the Terminate action to categorize errors (e.g., "NetworkError", "ValidationError") for easier filtering in logs.
- Avoid nesting multiple Terminate actions; keep the logic flat within the Catch block.
- Use `result()` expressions sparingly as they can be computationally expensive in very large scopes.

**When NOT to use:**
- Do not use Terminate if you are inside a **"Apply to each"** loop and want the loop to continue processing other items after one fails.
- Do not use Terminate if you have a **"Finally"** block that must run regardless of success or failure.

---

## Interview Questions

### Beginner

**Q:** What happens to the Flow Run status if you handle an error in a Catch scope but do NOT use a Terminate action?

<details>
<summary>Answer</summary>

The Flow Run will be marked as **Succeeded**. Power Automate views the Catch scope as a successful resolution of the error. This is often undesirable because it hides failures from the Run History dashboard.

</details>

---

### Intermediate

**Q:** How can you pass the specific error message from a failed action inside a "Try" scope to the "Terminate" action in the "Catch" scope?

<details>
<summary>Approach</summary>

**Solution:**
Use the `result('Scope_Name')` expression. This returns an array of all actions within that scope. You must filter this array to find the action with a "Failed" status and then select its error message.

```javascript
// Example expression for the Message field in Terminate:
actions('My_Failed_Action')?['outputs']?['body']?['error']?['message']
// OR more robustly:
first(filter(result('Try_Scope'), item()['status'], 'equals', 'Failed'))['error']['message']
```

> [!TIP]
> Using `result()` is better than referencing a specific action because it dynamically finds whichever action in the scope caused the failure.

**Follow-up they'll ask:** "What if multiple actions failed in a parallel branch?"  
**Answer:** The `filter` expression will return an array of all failed actions; you would typically take the `first()` one or join them into a single string.

</details>

---

### Advanced

**Q:** In a high-volume mission-critical flow, how would you design a termination strategy that distinguishes between "System Failures" and "Business Rule Violations"?

<details>
<summary>Solution</summary>

**Architecture:**

```
[Main Logic]
  |-- Condition: Is Data Valid?
       |-- No: Terminate (Succeeded) with Message: "Business Rule Violation: Invalid SKU"
[Catch Scope] (Run After: Failed)
  |-- Log to Azure Application Insights
  |-- Terminate (Failed) with Message: "System Error: Connection Timeout"
```

**Key considerations:**
- **Business Violations:** Use `Terminate (Succeeded)` or `Terminate (Cancelled)` if the flow worked correctly but the data didn't meet criteria. This prevents false alarms.
- **System Errors:** Use `Terminate (Failed)` for unexpected exceptions (API down, Null values).

**Trade-offs to discuss:**
- **Option A (Terminate Failed for everything):** Easier to set up but creates "noise" in monitoring for expected business logic exits.
- **Option B (Granular Termination):** Requires more complex logic but provides much cleaner data for operational excellence.

</details>

---

## Comparison Table

| Aspect | No Terminate (in Catch) | Terminate (Failed) | Terminate (Cancelled) |
|----------|-----------|-----------|---------------|
| **Run History Status** | Succeeded | Failed | Cancelled |
| **Alerts Triggered** | No | Yes | No (usually) |
| **Use Case** | Recovery logic successful | Unrecoverable error | Process stopped by user/logic |
| **Downstream Actions** | Continue running | Stop immediately | Stop immediately |

---

## Real Example

> [!NOTE]
> **Problem:** A financial processing flow was failing to upload invoices to SharePoint due to intermittent network issues. Because the flow had a "Catch" block to email the admin, the flow runs always showed "Succeeded," leading the team to believe everything was fine while 20% of invoices were missing.  
> **Solution:** Added a **Terminate (Failed)** action at the end of the Catch block, using the `result()` expression to capture the SharePoint error.  
> **Result:** The IT team received automated alerts via the Power Platform Admin Center, and the failure rate became visible in the dashboard, leading to a fix in the network configuration.

**Implementation:**
```
Scope: Try_Upload
   - SharePoint: Create File
Scope: Catch_Errors (Run After: Failed)
   - Office 365 Outlook: Send Error Email
   - Terminate: Status = Failed, Message = result('Try_Upload')...message
```

---

## Quick Reference

### Error Extraction Cheat Sheet

| Goal | Expression |
|-----------|-----------------|
| Get all info from Scope | `result('Scope_Name')` |
| Get status of first action | `result('Scope_Name')[0]['status']` |
| Filter for failures | `filter(result('Scope_Name'), item()['status'], 'equals', 'Failed')` |

---

## Practice

**Exercise 1:** Create a flow that attempts to divide a number by zero (using an expression). Wrap this in a Try/Catch block. Ensure the flow run history shows "Failed" and includes the text "Division by zero is not allowed" in the error details.

<details>
<summary>Hint</summary>

Use a `Compose` action with the expression `div(10, 0)` inside a Scope named "Try_Scope". Set the "Catch_Scope" to run after "Try_Scope" has failed.

</details>

<details>
<summary>Solution</summary>

1. **Scope: Try_Scope**
   - Action: Compose (`div(10, 0)`)
2. **Scope: Catch_Scope** (Configure Run After: `Try_Scope` has failed)
   - Action: **Terminate**
     - Status: **Failed**
     - Code: `CalculationError`
     - Message: `Division by zero is not allowed`

**Key points:**
The flow will trigger the Catch scope because `div(10,0)` throws a runtime error. The Terminate action then forces the flow status to "Failed".
</details>

---

## Troubleshooting Guide

> [!CAUTION]
> **Common Errors:**

| Error | Cause | Fix |
|-------|-------|-----|
| Flow shows "Succeeded" despite errors. | Missing Terminate action in the Catch block. | Add a Terminate action with status "Failed" as the last step in the Catch block. |
| Terminate action is "Skipped". | "Configure Run After" on the Catch block or the Terminate action itself is incorrect. | Ensure the Catch Scope is set to run after the Try Scope "Has Failed". |
| `result()` expression fails. | The Scope name in the expression doesn't match the actual Scope name (spaces must be underscores). | Use `result('My_Scope_Name')` where spaces in the UI are replaced by underscores. |

---

## Tags
#patterns #error-handling #governance #architecture #administration