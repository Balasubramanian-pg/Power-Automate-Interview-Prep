# 53. Approval Actions Overview

Canonical documentation for 53. Approval Actions Overview. This document defines concepts, terminology, and standard usage.

## Purpose
Approval Actions represent the automated or manual operations triggered by the transition of a record or process through various states of an approval lifecycle. The purpose of these actions is to synchronize the state of the system with the human or algorithmic decisions made during the review process. By decoupling the decision logic from the resulting side effects, systems can ensure consistency, auditability, and operational efficiency.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
Clarify what is in scope and out of scope for this topic.

**In scope:**
* The taxonomy of actions triggered by approval state changes.
* The relationship between decision outcomes and system side effects.
* Theoretical frameworks for state transitions (Initial Submission, Approval, Rejection, Recall).
* Standard categories of actions (Notifications, Data Mutations, External Integrations).

**Out of scope:**
* Specific vendor implementations (e.g., Salesforce Flow, ServiceNow Workflow).
* UI/UX design for approval buttons or interfaces.
* Complex routing logic (e.g., parallel vs. serial approval paths), which is covered under "Approval Orchestration."

## Definitions
Provide precise definitions for key terms.

| Term | Definition |
|------|------------|
| **Approval Action** | A discrete operation executed automatically by the system in response to a change in approval status. |
| **Initial Submission** | The action(s) triggered when a record is first entered into an approval process, often involving record locking. |
| **Final Approval** | The state reached when all required approvers have granted consent, triggering terminal positive actions. |
| **Final Rejection** | The state reached when an approver denies the request, triggering terminal negative actions. |
| **Recall** | The action of withdrawing a request from the approval process by the original submitter or an administrator. |
| **Field Update** | A data mutation action that changes a specific value on the record being approved. |
| **Side Effect** | Any change outside the immediate record state, such as an email notification or an API call to an external system. |

## Core Concepts

### State-Driven Execution
Approval actions are fundamentally reactive. They do not determine the path of the approval; rather, they execute based on the *result* of the path. Every action is bound to a specific transition point in the state machine.

### Determinism and Idempotency
In a robust system, approval actions should be deterministic. Given the same state transition, the same actions should occur. Ideally, actions should be idempotent where possible, ensuring that if a system retry occurs, the final state remains consistent without unintended duplication (e.g., sending the same notification twice).

### Record Locking
A core concept of approval actions is the management of record mutability. Upon submission, a "Lock" action is typically applied to prevent data drift while a decision is pending. Upon final approval or rejection, an "Unlock" action restores editability.

## Standard Model

The standard model for Approval Actions categorizes operations into four primary trigger points:

1.  **Initial Submission Actions:** Executed when the user clicks "Submit."
    *   *Example:* Changing "Status" to "Pending," locking the record, and notifying the first-step approver.
2.  **Intermediate Step Actions:** Executed when an individual step within a multi-step process is approved or rejected.
    *   *Example:* Notifying the next approver in the chain.
3.  **Final Approval Actions:** Executed when the entire process is successfully completed.
    *   *Example:* Changing "Status" to "Active," updating an "Effective Date," and triggering a downstream provisioning system.
4.  **Final Rejection/Recall Actions:** Executed when the process is terminated without approval.
    *   *Example:* Changing "Status" to "Draft," unlocking the record for edits, and notifying the submitter of the rejection reason.

## Common Patterns

### The Notification Pattern
The most frequent action type. It involves dispatching asynchronous messages (Email, SMS, Push) to stakeholders. The pattern requires a template-based approach where record data is injected into the message body.

### The Audit Trail Pattern
Every action triggered should ideally generate an immutable log entry. This pattern ensures that for every state change, there is a record of what automated actions were taken, providing a "Source of Truth" for compliance.

### The External Synchronization Pattern
Triggering a webhook or an outbound API call to a third-party system (e.g., an ERP or HRIS) once final approval is reached. This ensures that the approval system acts as the authoritative gatekeeper for cross-platform data integrity.

## Anti-Patterns

*   **Circular Dependencies:** Configuring an approval action (like a field update) that inadvertently triggers a new approval process on the same record, leading to an infinite loop.
*   **Silent Failures:** Executing critical external actions (like a wire transfer) without a feedback loop or error-handling mechanism if the action fails.
*   **Hard-Coding Logic:** Embedding business logic within the action itself (e.g., "If Amount > 1000, send Email A, else Email B") rather than using the approval engine to route to different steps with dedicated actions.
*   **Over-Notification:** Triggering actions that notify too many stakeholders at intermediate steps, leading to "notification fatigue" and decreased responsiveness.

## Edge Cases

*   **Deleted Records:** If a record is deleted while an approval action is queued or in progress, the system must have a "tombstone" or graceful exit strategy to prevent orphaned processes.
*   **Delegate Approvals:** When an action is triggered by a delegate, the audit trail must capture both the intended approver and the actual actor to maintain accountability.
*   **Race Conditions:** Two approvers acting on a record simultaneously. The system must ensure that actions for the first processed decision are completed and the second decision is invalidated before its actions can trigger.
*   **Expired Tokens:** For actions involving external integrations, the failure of an authentication token during a "Final Approval Action" must be handled via a retry queue or administrative alert.

## Related Topics
*   **52. Approval Orchestration:** The logic and routing that lead to actions.
*   **54. State Machine Theory:** The underlying mathematical model for status transitions.
*   **12. Notification Services:** The infrastructure used to execute messaging actions.
*   **88. Audit Logging Standards:** The requirements for recording action history.

## Change Log

| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-16 | Initial AI-generated canonical documentation |