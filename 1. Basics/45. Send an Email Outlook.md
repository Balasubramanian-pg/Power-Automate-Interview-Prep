# 45. Send an Email Outlook

Canonical documentation for 45. Send an Email Outlook. This document defines concepts, terminology, and standard usage.

## Purpose
The "Send an Email Outlook" topic addresses the requirement for programmatic or automated dispatch of electronic mail through the Microsoft Outlook/Exchange ecosystem. This functionality exists to bridge the gap between automated systems (such as ERPs, CRMs, or workflow engines) and the professional communication infrastructure used by organizations. It ensures that communications are sent from a verified corporate identity, adhering to organizational security policies, retention rules, and delivery standards.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
Clarify what is in scope and out of scope for this topic.

**In scope:**
* **Message Dispatch Logic:** The theoretical framework for constructing and transmitting a message via the Outlook service.
* **Identity and Authentication:** The conceptual requirements for authorizing a "send" action on behalf of a user or service principal.
* **Data Structures:** The fundamental components required for a valid email request (Recipients, Body, Subject, Metadata).
* **Service Constraints:** Theoretical boundaries such as rate limiting, attachment size limits, and delivery protocols.

**Out of scope:**
* **Specific SDK Syntax:** Code-level implementation details for specific languages (e.g., Python, C#, JavaScript).
* **UI/UX Design:** The visual layout of the Outlook desktop or web client.
* **Third-party SMTP Relays:** Sending mail through non-Microsoft infrastructure.

## Definitions
Provide precise definitions for key terms.

| Term | Definition |
|------|------------|
| **Mailbox Provider** | The entity (Microsoft Exchange/Outlook) hosting the user's mail data and handling transport. |
| **Service Principal** | An identity created for use with applications, hosted services, and automated tools to access specific resources. |
| **MIME** | Multipurpose Internet Mail Extensions; the standard for formatting non-ASCII text and attachments. |
| **Throttling** | The intentional slowing or limiting of requests by the service provider to maintain system stability. |
| **OAuth 2.0** | The industry-standard protocol for authorization used to grant scoped access to a mailbox. |
| **Graph API** | The primary gateway for interacting with Microsoft 365 data and services. |

## Core Concepts
### 1. Identity Context
Sending an email via Outlook requires a defined identity context. This can be a **User Context** (where the email is sent as the authenticated user) or an **Application Context** (where a background service sends mail, often using "Send As" or "Send on Behalf of" permissions).

### 2. Message Composition
A message is a structured object consisting of:
*   **Headers:** Metadata including `To`, `CC`, `BCC`, `Subject`, and `Importance`.
*   **Body:** The primary content, typically formatted as Plain Text or HTML.
*   **Attachments:** Binary data or links to cloud-hosted files associated with the message.

### 3. Transport Mechanism
The "Send" action triggers a handoff from the requesting system to the Microsoft Transport Pipeline. This pipeline handles address resolution, anti-spam filtering, and final delivery to the recipient's Mail Transfer Agent (MTA).

## Standard Model
The standard model for sending an email via Outlook follows a four-stage lifecycle:

1.  **Authentication & Authorization:** The system proves its identity and verifies it has the `Mail.Send` permission.
2.  **Request Validation:** The service checks the message structure for compliance (e.g., valid recipient formats, size limits).
3.  **Asynchronous Dispatch:** The message is placed in the "Outbox" or "Sent Items" and queued for delivery.
4.  **Telemetry/Confirmation:** The service returns a success code (e.g., HTTP 202 Accepted) indicating the message has been accepted for delivery.

## Common Patterns
*   **Transactional Notifications:** Automated alerts triggered by system events (e.g., password resets, order confirmations).
*   **Delegated Sending:** An application sending mail on behalf of a specific executive or department mailbox using delegated permissions.
*   **HTML Templating:** Using dynamic placeholders within an HTML body to personalize mass communications.
*   **Draft-to-Send:** Creating a message in the "Drafts" folder for manual review before programmatic dispatch.

## Anti-Patterns
*   **Hardcoding Credentials:** Storing usernames and passwords directly in scripts rather than using OAuth tokens or Secret Managers.
*   **Ignoring Rate Limits:** Failing to implement retry logic or "back-off" strategies when the service returns throttling errors.
*   **Large Binary Attachments:** Attaching massive files (e.g., >25MB) directly to the email instead of providing links to cloud storage (OneDrive/SharePoint).
*   **High-Volume Marketing:** Using a standard Outlook mailbox for bulk marketing blasts, which can lead to the mailbox being flagged for spam.

## Edge Cases
*   **Mailbox Full:** The request fails because the sender's "Sent Items" or the recipient's "Inbox" has exceeded its storage quota.
*   **Invalid Recipient Syntax:** A recipient address is syntactically correct but does not exist, leading to a "Non-Delivery Report" (NDR) after the initial send success.
*   **Attachment Type Restrictions:** The service blocks specific file extensions (e.g., .exe, .bat) for security reasons.
*   **Transient Connectivity:** Network interruptions occurring between the "Acceptance" of the message and the actual "Dispatch."

## Related Topics
*   **OAuth 2.0 Authentication Flow:** The prerequisite for securing the connection.
*   **Microsoft Graph API Documentation:** The technical interface for modern Outlook integrations.
*   **SMTP Protocol:** The underlying legacy protocol for mail transport.
*   **DMARC/SPF/DKIM:** Security frameworks that validate the sender's domain authority.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-16 | Initial AI-generated canonical documentation |