# 52. Do Until Loop

Canonical documentation for 52. Do Until Loop. This document defines concepts, terminology, and standard usage.

## Purpose
The **Do Until Loop** is a control flow statement designed to execute a block of code repeatedly until a specified condition evaluates to true. It addresses the need for iterative processing where the termination state is defined by a goal or a "stop" signal, rather than a "continue" signal. 

This structure is primarily used when the number of iterations is not known a priori and the logic is most naturally expressed as "repeat this action until the objective is met."

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
Clarify what is in scope and out of scope for this topic.

**In scope:**
* Logical structure of "Until" termination.
* Evaluation timing (Pre-test vs. Post-test).
* Relationship between the predicate and the loop body.
* Deterministic and non-deterministic termination.

**Out of scope:**
* Specific syntax for languages such as VBA, Perl, or Ruby.
* Memory management during iteration.
* Parallelization of loop iterations.

## Definitions
| Term | Definition |
|------|------------|
| **Predicate** | The boolean expression evaluated to determine if the loop should terminate. |
| **Loop Body** | The sequence of statements executed during each iteration of the loop. |
| **Iteration** | A single execution of the loop body. |
| **Post-test Loop** | A loop where the predicate is evaluated *after* the loop body has executed, ensuring at least one execution. |
| **Pre-test Loop** | A loop where the predicate is evaluated *before* the loop body executes; if the condition is met initially, the body may never run. |
| **Termination Condition** | The specific state of the predicate (True) that triggers the exit from the loop. |

## Core Concepts

### 1. Negative Logic
The fundamental characteristic of a Do Until loop is its use of negative logic relative to a "While" loop. While a "While" loop continues as long as a condition is **True**, a "Do Until" loop continues as long as a condition is **False**. The loop "breaks" or terminates the moment the predicate evaluates to **True**.

### 2. Evaluation Timing
*   **Post-test (Standard):** In most canonical models, a "Do Until" loop is a post-test construct. The body executes first, and the condition is checked at the bottom. This guarantees that the code block runs at least once, regardless of the initial state of the predicate.
*   **Pre-test:** Some implementations allow for an "Until" check at the top of the loop. In this scenario, if the termination condition is met before the first iteration, the loop body is bypassed entirely.

### 3. State Mutation
For a Do Until loop to be finite, the execution of the loop body (or an external asynchronous event) must eventually mutate the state such that the predicate evaluates to True.

## Standard Model
The standard model for a Do Until loop follows this logical flow:

1.  **Entry:** The control flow enters the loop structure.
2.  **Execution:** The statements within the loop body are executed sequentially.
3.  **Evaluation:** The predicate (termination condition) is evaluated.
4.  **Branching:**
    *   If the predicate is **False**, the flow returns to Step 2.
    *   If the predicate is **True**, the flow exits the loop and proceeds to the next statement in the program.

## Common Patterns

### 1. The Sentry Pattern
A variable (the sentry) is initialized before the loop. The loop body performs tasks and updates the sentry. The loop terminates when the sentry reaches a specific threshold or state (e.g., `Until counter == 10`).

### 2. The Event-Driven Polling Pattern
The loop body checks the status of an external resource (e.g., a file buffer or a network socket). The loop continues until the resource reports a "Ready" or "Complete" status.

### 3. User Input Validation
The loop body prompts a user for input. The predicate evaluates whether the input meets specific criteria. The loop repeats until the user provides valid data.

## Anti-Patterns

### 1. The Infinite Loop (Unreachable Truth)
Occurs when the loop body does not modify the variables involved in the predicate, or modifies them in a way that the termination condition can never be satisfied.
*   *Example:* `Until x < 0` where the loop body only increments `x`.

### 2. The "While-Logic" Inversion
Applying "While" logic to an "Until" loop. This often results in the loop terminating immediately or not running at all because the developer provided a "continue" condition instead of a "stop" condition.

### 3. Side-Effect Predicates
Placing logic that modifies state inside the predicate evaluation itself. This can lead to "off-by-one" errors or make the code difficult to debug, as the state changes during the check rather than within the body.

## Edge Cases

### 1. Immediate Termination
In a pre-test "Until" loop, if the condition is True upon entry, the loop body is never executed. Documentation and logic must account for the possibility of zero iterations.

### 2. External Mutation
If the predicate relies on a global variable or an external hardware state, the loop may terminate unexpectedly or hang if the external factor does not behave as predicted. This is common in multi-threaded environments where the predicate is not thread-safe.

### 3. Overflow/Underflow
In systems with fixed-width integers, an "Until" condition that relies on reaching a specific value may be bypassed if the variable overflows, potentially leading to an infinite loop (e.g., `Until x > 100` where `x` jumps from 90 to -128 due to overflow).

## Related Topics
*   **51. While Loop:** The logical inverse of the Do Until loop.
*   **12. Control Flow:** The broader category of instructions that determine the execution path.
*   **88. Recursion:** An alternative method of iteration through self-referential function calls.
*   **04. Boolean Logic:** The mathematical foundation for predicate evaluation.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-16 | Initial AI-generated canonical documentation |