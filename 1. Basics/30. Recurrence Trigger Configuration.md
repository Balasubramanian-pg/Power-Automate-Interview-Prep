# 30. Recurrence Trigger Configuration

Canonical documentation for 30. Recurrence Trigger Configuration. This document defines concepts, terminology, and standard usage.

## Purpose
Recurrence Trigger Configuration provides a standardized mechanism for automating the execution of processes at predefined, repeating intervals. It addresses the requirement for temporal determinism in automated systems, ensuring that tasks—such as data synchronization, report generation, or system maintenance—occur consistently without manual intervention. This topic establishes the logic required to define "when" and "how often" a process should initiate, independent of the underlying execution engine.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
**In scope:**
*   Temporal logic and scheduling parameters (Frequency, Interval, Start Time).
*   Time zone handling and Daylight Saving Time (DST) reconciliation.
*   Execution constraints and boundary definitions.
*   Theoretical models for recurring event calculation.

**Out of scope:**
*   Specific vendor syntax (e.g., CRON expressions, YAML schemas for specific cloud providers).
*   Execution engine internals (how the task is actually run).
*   Error handling and retry logic (covered under "Fault Tolerance").

## Definitions
| Term | Definition |
|------|------------|
| **Recurrence** | The state of an event repeating according to a defined pattern or schedule. |
| **Frequency** | The unit of time used to measure the recurrence (e.g., Second, Minute, Hour, Day, Week, Month). |
| **Interval** | A multiplier applied to the frequency to determine the gap between occurrences (e.g., an interval of 2 with a frequency of "Day" results in execution every two days). |
| **Start Time** | The absolute temporal point at which the recurrence pattern becomes active. |
| **Wall-clock Time** | The time as shown by a clock in a specific time zone, subject to adjustments like DST. |
| **Monotonic Time** | A strictly increasing time source used to measure duration, unaffected by system clock adjustments. |
| **Drift** | The cumulative lag between the intended schedule and the actual execution time. |
| **Jitter** | Intentional or unintentional random variation in the timing of a trigger to prevent thundering herd problems. |

## Core Concepts

### Temporal Determinism
A recurrence trigger must be deterministic; given a start time and a recurrence rule, the system must be able to calculate all future execution points (occurrences) accurately.

### Time Zone Context
Recurrence triggers operate in either **Absolute Time (UTC)** or **Relative Time (Local)**. 
*   **UTC-based triggers** are immune to regional shifts but may result in "shifting" local execution times during DST transitions.
*   **Local-time triggers** maintain the same wall-clock time (e.g., 09:00 AM) but require logic to handle "skipped" or "repeated" hours during DST changes.

### Occurrence Calculation
The calculation of the "Next Run Time" typically follows the formula:
`NextRun = LastScheduledRun + (Frequency * Interval)`
However, in calendar-aware systems, this must account for varying month lengths and leap years.

## Standard Model
The standard model for Recurrence Trigger Configuration consists of four primary components:

1.  **The Schedule Definition:** Defines the frequency, interval, and specific constraints (e.g., "Mondays only").
2.  **The Temporal Anchor:** The Start Time and Time Zone that provide the reference point for all subsequent calculations.
3.  **The Evaluation Engine:** The logic that compares the current system time against the calculated Next Run Time.
4.  **The Execution Window:** The period during which a trigger is considered "valid" for initiation if the system was offline at the exact scheduled moment.

## Common Patterns

### Fixed Interval (Polling)
The trigger fires exactly $X$ units of time after the *start* of the previous execution. This pattern is used when a consistent cadence is more important than the specific time of day.

### Calendar-Based (Cron-style)
The trigger fires at specific points on the calendar (e.g., "The 1st of every month at 00:00"). This is used for business logic that aligns with human schedules.

### Sliding Window
The next trigger is calculated based on the *completion* time of the previous task rather than the start time. This prevents overlapping executions if a task takes longer than the defined interval.

### Thundering Herd Mitigation (Jitter)
In large-scale systems, triggers are configured with a "Random Delay" or Jitter. Instead of 10,000 instances triggering at exactly 12:00:00, they are spread across 12:00:00 to 12:00:30 to prevent resource exhaustion.

## Anti-Patterns

### Overlapping Schedules
Configuring an interval shorter than the expected execution duration without concurrency controls. This can lead to resource exhaustion or race conditions.

### Hard-coding DST Offsets
Manually calculating offsets (e.g., UTC+1) instead of using named Time Zones (e.g., `Europe/London`). This causes schedules to break when regional DST rules change.

### Reliance on Execution Duration for Timing
Assuming a task will always take $N$ seconds and scheduling the next task based on that assumption. If the task slows down, the schedule drifts.

### Lack of Catch-up Policy
Failing to define what happens if the system is down during a scheduled trigger. Without a policy, the system may either skip the execution entirely or "firehose" all missed executions simultaneously upon restart.

## Edge Cases

### The DST "Gap" (Spring Forward)
When the clock jumps from 01:59 to 03:00, a trigger scheduled for 02:30 does not technically exist on that day.
*   *Standard Resolution:* Execute at the next available minute (03:00) or skip.

### The DST "Overlap" (Fall Back)
When the clock jumps from 01:59 back to 01:00, the time 01:30 occurs twice.
*   *Standard Resolution:* Execute only on the first occurrence or require a disambiguation flag.

### Leap Years and Month-End
Triggers set for the 31st of the month.
*   *Standard Resolution:* For months with fewer than 31 days, the trigger typically fires on the last day of the month (e.g., Feb 28/29).

### System Clock Synchronization
If a system clock is synchronized via NTP and jumps backward, a recurrence trigger might fire a second time for the same scheduled slot.

## Related Topics
*   **12. Workflow Orchestration:** The broader context in which triggers operate.
*   **45. Concurrency and Throttling:** Managing multiple executions initiated by triggers.
*   **08. Time Series Data:** Often the output or input for recurring tasks.
*   **Event-Driven Architecture:** The alternative to recurrence-based (polling) triggers.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-16 | Initial AI-generated canonical documentation |