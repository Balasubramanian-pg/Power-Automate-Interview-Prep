# 54. Start and Wait for Approval

Canonical documentation for 54. Start and Wait for Approval. This document defines concepts, terminology, and standard usage.

## Purpose
The "Start and Wait for Approval" pattern addresses the requirement for human-in-the-loop (HITL) intervention within automated workflows. It facilitates a transition from automated execution to manual decision-making, ensuring that a process remains in a suspended state until a definitive response is provided by an authorized entity. This pattern is essential for governance, compliance, and quality control in business logic where automated heuristics are insufficient for high-stakes decision-making.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative.

## Scope
Clarify what is in scope and out of scope for this topic.

**In scope:**
* The lifecycle of an approval request from instantiation to resolution.
* State management of the parent process during the waiting period.
* Logic governing response aggregation and outcome determination.
* Security and identity requirements for approval entities.

**Out of scope:**
* Specific UI/UX implementations of approval buttons or email templates.
* Vendor-specific connector configurations.
* Physical document signing (e-signatures are considered a separate, though related, domain).

## Definitions
Provide precise definitions for key terms.

| Term | Definition |
|------|------------|
| **Approver** | The identity (individual or group) authorized to provide a response to the request. |
| **Requester** | The entity (human or system) that initiated the workflow requiring approval. |
| **Outcome** | The final status of the request (e.g., Approved, Rejected, Abstained). |
| **Suspension** | The state in which the parent workflow pauses execution and releases compute resources while waiting for a response. |
| **Callback** | The mechanism by which the approval system notifies the workflow engine that a decision has been reached. |
| **Escalation** | A secondary logic path triggered when a response is not received within a defined threshold. |

## Core Concepts
### State Persistence
Unlike a simple "fire and forget" notification, the "Start and Wait" pattern requires the workflow engine to persist the state of the process. This allows the workflow to survive for days, weeks, or months without consuming active memory or CPU cycles, resuming only when the external approval event is triggered.

### Identity and Authorization
The pattern relies on a robust identity provider. The system must verify that the entity providing the response matches the entity assigned to the task. This ensures the integrity of the audit trail.

### Outcome Mapping
Every approval must result in a discrete outcome. These outcomes are typically mapped to boolean logic (True/False) or enumerated values (Approve/Reject/Needs Revision) that dictate the subsequent path of the workflow.

## Standard Model
The standard model for "Start and Wait for Approval" follows a four-phase lifecycle:

1.  **Instantiation:** The workflow generates a unique Approval ID and defines the metadata (Approvers, Details, Context).
2.  **Notification & Suspension:** The system dispatches a request to the Approver(s) via an out-of-band channel (Email, Push, Dashboard) and enters a "Waiting" state.
3.  **External Input:** The Approver interacts with the request. The system validates the Approver's identity and the validity of the response.
4.  **Resumption:** Upon receipt of a valid response, the workflow engine retrieves the persisted state, injects the approval data, and continues execution along the branch corresponding to the outcome.

## Common Patterns
*   **Single Approver:** The first response from a single assigned individual determines the outcome.
*   **Consensus (Everyone must approve):** The workflow remains suspended until all assigned approvers provide an "Approve" response. A single "Reject" typically terminates the process.
*   **First to Respond:** Multiple individuals are notified, but the first response received dictates the outcome for the entire group.
*   **Sequential Approval:** The request is sent to Approver A; only upon A's approval is the request generated for Approver B.
*   **Weighted Approval:** Outcomes are determined by a quorum or a specific percentage of affirmative responses.

## Anti-Patterns
*   **Polling for Response:** Designing a workflow that stays "Active" and repeatedly checks a database for a response. This wastes resources and is not scalable.
*   **Hardcoded Approvers:** Embedding specific user IDs or email addresses directly into the workflow logic rather than using dynamic lookups or role-based groups.
*   **Lack of Timeouts:** Failing to define a maximum wait duration, leading to "zombie" workflows that stay suspended indefinitely.
*   **Implicit Approvals:** Assuming an approval if no response is received (unless specifically required by a "Silence implies consent" business policy, which should be explicitly modeled).

## Edge Cases
*   **Approver Unavailability:** The assigned approver leaves the organization or is on extended leave while a workflow is suspended.
*   **Race Conditions:** Two approvers in a "First to Respond" pattern submit their decisions at the exact same millisecond.
*   **Malformed Callbacks:** An external system sends a response that does not match the expected schema or contains an invalid Outcome ID.
*   **Workflow Versioning:** The parent workflow logic is updated while an approval is pending. The system must decide whether to resume in the old version or the new version.
*   **Retractions:** A requester attempts to cancel the approval request after it has been sent but before it has been acted upon.

## Related Topics
*   **State Machines:** The underlying logic structure often used to manage complex approval lifecycles.
*   **Audit Logging:** The requirement to record who approved what and when for compliance purposes.
*   **Notification Services:** The transport layer used to alert approvers.
*   **Role-Based Access Control (RBAC):** The framework used to manage who is authorized to be an Approver.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-16 | Initial AI-generated canonical documentation |