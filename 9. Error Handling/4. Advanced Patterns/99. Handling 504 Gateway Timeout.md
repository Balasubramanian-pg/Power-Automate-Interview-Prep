# 99. Handling 504 Gateway Timeout

Canonical documentation for 99. Handling 504 Gateway Timeout. This document defines the conceptual model, terminology, and standard usage patterns.

> [!NOTE]
> This documentation is implementation-agnostic and intended to serve as a stable reference.

## 1. Purpose and Problem Space
Describe why 99. Handling 504 Gateway Timeout exists and the class of problems it addresses.
The 504 Gateway Timeout error occurs when a server acting as a gateway or proxy does not receive a timely response from an upstream server it needed to access in order to complete the request. This document aims to provide a comprehensive guide on handling 504 Gateway Timeout errors, which are a class of problems that can significantly impact the reliability, performance, and user experience of web applications and services.

## 2. Conceptual Overview
Provide a high-level mental model of the topic.
At a high level, handling 504 Gateway Timeout involves understanding the nature of the error, identifying its root causes, and implementing strategies to prevent, detect, and recover from such errors. This includes configuring server timeouts, optimizing server performance, implementing retry mechanisms, and monitoring server health.

## 3. Terminology and Definitions
| Term | Definition |
|------|------------|
| Gateway | A server that acts as an intermediary between a client and a server, facilitating communication between them. |
| Proxy Server | A server that acts on behalf of a client to retrieve resources from another server, often used for caching, filtering, or load balancing. |
| Upstream Server | The server that a gateway or proxy server communicates with to retrieve resources on behalf of a client. |
| Timeout | The maximum amount of time a server will wait for a response from another server before considering the request failed. |
| Retry Mechanism | A strategy for automatically reattempting a failed request in hopes of succeeding on a subsequent attempt. |

## 4. Core Concepts
Explain the fundamental ideas that form the basis of this topic.
The core concepts in handling 504 Gateway Timeout include understanding the timeout hierarchy (client to gateway, gateway to upstream server), recognizing the impact of network conditions and server load on timeout occurrences, and developing strategies for timeout prevention and recovery. This also involves distinguishing between idempotent and non-idempotent requests to safely implement retry logic without causing unintended side effects.

## 5. Standard Model
Describe the generally accepted or recommended model.
The standard model for handling 504 Gateway Timeout involves a multi-step approach: 
1. **Prevention**: Optimize server and network configurations to minimize the likelihood of timeouts.
2. **Detection**: Implement monitoring to quickly identify when a 504 error occurs.
3. **Retry**: For idempotent requests, automatically retry the request after a short delay.
4. **Fallback**: If retries fail, provide a fallback experience or message to the user.
5. **Analysis**: Regularly analyze timeout occurrences to identify and address root causes.

## 6. Common Patterns
Document recurring, accepted patterns.
Common patterns include:
- **Exponential Backoff**: Gradually increasing the delay between retries to avoid overwhelming the server.
- **Circuit Breaker Pattern**: Temporarily stopping requests to a failing service to prevent cascading failures.
- **Load Balancing**: Distributing workload across multiple servers to reduce the load on any single server and minimize timeouts.

## 7. Anti-Patterns
Describe common but discouraged practices.
Anti-patterns include:
- **Blind Retries**: Retrying requests without considering whether the request is idempotent or the potential for causing duplicate side effects.
- **Ignoring Timeouts**: Failing to monitor, analyze, or address timeout errors, leading to poor user experience and potential data inconsistencies.
- **Overly Aggressive Timeout Settings**: Setting timeouts too low, leading to premature abandonment of requests that might have otherwise succeeded with a bit more time.

## 8. References
Provide exactly five authoritative external references.
1. [RFC 7231 - Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content](https://tools.ietf.org/html/rfc7231)
2. [Mozilla Developer Network - HTTP/504 Gateway Timeout](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/504)
3. [W3C - HTTP/1.1 Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)
4. [Microsoft Documentation - HTTP errors in ASP.NET Core](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/index?view=aspnetcore-5.0#http-errors)
5. [Apache HTTP Server Documentation - ProxyTimeout](https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxytimeout)

## 9. Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-01-23 | Initial documentation |